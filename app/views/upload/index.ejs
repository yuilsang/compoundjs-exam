<%-include ../layouts/header%>
<style>
h1.title {
	font-size:50px;
}

.alert-message .block-message .info {
	background-color: #ddf4fb;
	border-color: #c6edf9;
}

.alert-message {
	color: #404040;
	text-shadow: 0 1px 0 rgba(255,255,255,0.5);
}
</style>
<div class="container-narrow">
<div class="masthead">
<%-include ../layouts/menu%>
<h3 class="muted">JSKit</h3>
</div>
<hr>


<div class="footer">
<p>&copy; yuilsang 2013</p>
</div>
</div> <!-- /container -->
<%-include ../layouts/footer%>


<div class="page-header"><h1>upload#index</h1></div>

<h3>Uploaded File List</h3>
<ul id="filelist">
</ul>
<hr>


<h3>Upload</h3>
<h5>File Upload</h5>
<% var form = formFor("upload_test", { action: "/upload/filesave", method: "post", enctype: "multipart/form-data" }); %>
<%- form.begin() %>
<input name="file" id="file" type="file" value="" style="width:60px;height:25px" />
<br><br>
<button type="submit" class="btn btn-large btn-primary">upload</button>
<%- form.end() %>
<hr>


<h5>HTML5 Image Uploader</h5>

<a href="#" class="thumbnail" style="width:360px" id="dropbox">
<img data-src="holder.js/360x270" alt="360x270" style="width: 360px; height: 270px;" src="data:image/png;base64,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">
</a>
<br>

<div class="progress progress-striped active" style="width:400px">
<div class="bar" style="width: 0%;"></div>
</div>

<script type="text/javascript">

var initFileList = function() {
	$.ajax({
		type: "GET",
		url: "/upload/filelist.json",
		data: {}
	}).done(function( msg ) {
		console.log(msg);
		var filelist = msg.filelist;
		for(var i=0;i<filelist.length;i++) {
			$("#filelist").append("<li>"+filelist[i]+"</li>");
		}
	});
};

initFileList();

var initUpload = function() {
	var dropbox = $('#dropbox');

	dropbox.filedrop({
		paramname:'file',
		data : {
			authenticity_token: $('meta[name=csrf-token]').attr('content')
		},
		maxfiles: 5,
    	maxfilesize: 5,
		url: '/upload/filesave.json',

		uploadFinished:function(i,file,response){
			//console.log("uploadFinished", i,response); // file,

			setTimeout(function() {
				$(".progress .bar").width(0);
			}, 1000);
		},

    	error: function(err, file) {
			switch(err) {
				case 'BrowserNotSupported':
					showMessage('Your browser does not support HTML5 file uploads!');
					break;
				case 'TooManyFiles':
					alert('Too many files! Please select 5 at most! (configurable)');
					break;
				case 'FileTooLarge':
					alert(file.name+' is too large! Please upload files up to 2mb (configurable).');
					break;
				default:
					break;
			}
		},

		// Called before each upload is started
		beforeEach: function(file){

		},

		uploadStarted:function(i, file, len){
			//console.log("uploadStarted:", i, len); // file,
		},

		progressUpdated: function(i, file, progress) {
			console.log("progressUpdated", i, progress); // file,
			$(".progress .bar").width(progress+"%");
		}

	});
};

initUpload();

// authenticity_token: $('meta[name=csrf-token]').attr('content')
</script>

<%-include ../layouts/footer%>